<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/css/reset.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.css">
    <script src="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.js"></script>
  </head>
  <body class="mixpanel-platform-body">
    <h1 id="here">Hello, World!</h1>
    <script>
      // Run queries and display results here
      var showCompanies = function (eventType,businessType,customerType) {
          
          var from = "2018-05-01";
          var to = "2018-05-31";

          var params = {
            from: from,
            to: to,
            eventType: eventType,
            businessType: businessType,
            customerType: customerType
          };
          
          
          if (customerType) {
            MP.api.jql(function main() {
            return Events ({
                from_date: params.from,
                to_date: params.to,
              event_selectors:[{event: "Login"}]
              })
              
              .filter(function(item) {
                return item.properties.EventType == params.eventType && item.properties.BusinessType == params.businessType && item.properties.CustomerType == "Advisory"
              }
                )
                
                .groupBy(["properties.CompanyName"], mixpanel.reducer.count());
            }, params).done(function(results) {
              console.log(results[0].key);
            });
          } else {
            MP.api.jql(function main() {
            return Events ({
                from_date: params.from,
                to_date: params.to,
              event_selectors:[{event: "Login"}]
              })
              
              .filter(function(item) {
                return item.properties.EventType == params.eventType && item.properties.BusinessType == params.businessType && item.properties.CustomerType != "Advisory"
              }
                )
                
                .groupBy(["properties.CompanyName"], mixpanel.reducer.count());
              }, params).done(function(results) {
                var here = document.getElementById("here"); 
                here.innerHTML = results[0].key;
              });
          }
          
          
        }
        showCompanies("Auction","Wholesale",0);
    </script>
  </body>
</html>





