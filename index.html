<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/css/reset.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.css">
    <script src="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.js"></script>
  </head>
  <body class="mixpanel-platform-body">
    <h1>Hello, World!</h1>
    <script>
      // Run queries and display results here
      var showCompanies = function (eventType,businessType,customerType) {
          
          // var from = document.getElementById("from").value;
          // var to = document.getElementById("to").value;
          
          var params2 = {
            // fromDate: from,
            // toDate: to,
            eventType2: eventType,
            businessType2: businessType,
            customerType2: customerType
          };
          
          if (customerType) {
            MP.api.jql(function main() {
            return Events ({
                // from_date: params2.from,
                // to_date: params2.to,
                from_date: "2018-05-01",
                to_date: "2018-05-31",
              event_selectors:[{event: "Login"}]
              })
              
              .filter(function(item) {
                return item.properties.EventType == params2.eventType2 && item.properties.BusinessType == params2.businessType2 && item.properties.CustomerType == "Advisory"
              }
                )
                
                .groupBy(["properties.CompanyName"], mixpanel.reducer.count());
            },params2).done(function(results) {
              console.log(results[0].key);
            });
          } else {
            alert(params2["eventType2"]);
            MP.api.jql(function main() {
              alert(5);
            return Events ({
                from_date: "2018-05-01",
                to_date: "2018-05-31",
              event_selectors:[{event: "Login"}]
              })
              
              .filter(function(item) {
                return item.properties.EventType == params2["eventType2"] && item.properties.BusinessType == params2["businessType2"] && item.properties.CustomerType != "Advisory"
              }
                )
                
                .groupBy(["properties.CompanyName"], mixpanel.reducer.count());
              },params2).done(function(results) {
                console.log(results[0].key);
              });
          }
          
          
        }
        showCompanies("Auction","Wholesale",0);
    </script>
  </body>
</html>
